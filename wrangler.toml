name = "grepbase"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]
pages_build_output_dir = ".vercel/output/static"

# Analytics Engine binding for monitoring
[[analytics_engine_datasets]]
binding = "ANALYTICS"

# Queues for background processing
[[queues.producers]]
binding = "REPO_INGEST_QUEUE"
queue = "repo-ingest-queue"

[[queues.consumers]]
queue = "repo-ingest-queue"
max_batch_size = 1
max_batch_timeout = 30
max_retries = 3
dead_letter_queue = "repo-ingest-dlq"

# Observability
[observability]
enabled = true

# D1 Database binding
[[d1_databases]]
binding = "grepbase_db"
database_name = "grepbase-db"
database_id = "326233af-b937-4c0b-ab47-7349f251b961"
migrations_dir = "drizzle"

# KV Namespace binding
[[kv_namespaces]]
binding = "grepbase_cache"
id = "6fbff750f7314c7ca6435e68966769bb"

# Environment-specific configuration
[env.production]
vars = { ENVIRONMENT = "production" }

[[env.production.d1_databases]]
binding = "grepbase_db"
database_name = "grepbase-db"
database_id = "326233af-b937-4c0b-ab47-7349f251b961"
migrations_dir = "drizzle"

[[env.production.kv_namespaces]]
binding = "grepbase_cache"
id = "6fbff750f7314c7ca6435e68966769bb"

[[env.production.analytics_engine_datasets]]
binding = "ANALYTICS"

[env.preview]
vars = { ENVIRONMENT = "preview" }

[[env.preview.d1_databases]]
binding = "grepbase_db"
database_name = "grepbase-db"
database_id = "326233af-b937-4c0b-ab47-7349f251b961"
migrations_dir = "drizzle"

[[env.preview.kv_namespaces]]
binding = "grepbase_cache"
id = "6fbff750f7314c7ca6435e68966769bb"

[[env.preview.analytics_engine_datasets]]
binding = "ANALYTICS"
